<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSAP Curso @midudev</title>
    <style>
        body{
            background-color: #222;
            font-family: system-ui;
            height: 5000px;
        }

        .box{
            width: 75px;
            height: 75px;
            border-radius: 12px;
            background-color: pink;
            margin-bottom: 6px;

            &.purple{
                background-color: rgb(200, 200, 255);
            }

            &.blue{
                background-color: lightskyblue;
            }

            &.green{
                background-color: lightgreen;
            }
        }

        .grid{
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            
            img{
                aspect-ratio: 5/8;
                width: 100%;
            }
        }

        #log{
            color: white;
        }

        .text{
            color: white;
            text-wrap: balance;
            text-align: center;

        }

        .title{
            color: white;
            text-wrap: balance;
            text-align: center;
            font-size: 15vw;
            width: 100%;

            position: fixed;
            left: 50%;
            top: 35%;
            transform: translate(-50%, -50%);
        }

        canvas{
            position: fixed;
            left: 50%;
            top: 40%;
            transform: translate(-50%, -50%);
            aspect-ratio: 1068/600;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- <div class="box"></div>
    <div class="box"></div>
    <div class="box"></div>
    <div class="box"></div>
    <div class="box"></div> -->

    <!-- <div class="grid">
        <img src="https://i.pinimg.com/564x/63/1b/0f/631b0ffb4742f20387be121bcc67801b.jpg">
        <img src="https://hablandodecomics.wordpress.com/wp-content/uploads/2012/08/iron-man-216.jpg">
        <img src="https://hablandodecomics.wordpress.com/wp-content/uploads/2012/02/portada-82-silver-surfer.jpg">
        <img src="https://hablandodecomics.wordpress.com/wp-content/uploads/2012/02/portada-90-batman-648.jpg">
        <img src="https://hablandodecomics.wordpress.com/wp-content/uploads/2012/02/portada-86-x-men-190.jpg">
        <img src="https://hablandodecomics.wordpress.com/wp-content/uploads/2012/02/portada-88-x-men.jpg">
        <img src="https://f.rpp-noticias.io/2020/10/15/10103421jpg.jpg">
        <img src="https://hablandodecomics.wordpress.com/wp-content/uploads/2012/08/what-if-43.jpg">
        <img src="https://i.pinimg.com/564x/38/00/2f/38002f67df2a00194a03661795a2e015.jpg">
    </div> -->

    <!-- <div class="box purple"></div>
    <div class="box blue"></div>
    <div class="box green"></div>

    <footer>
        <button id="play">Reproducir</button>
        <button id="pause">Pausa</button>
        <button id="resume">Resumir</button>
        <button id="reverse">Revertir</button>
        <button id="restart">Reiniciar</button>
        <button id="turbo">Soy Turbo</button>
    </footer>
    <small id="log"></small> -->

    <!-- <h1 class="text">El código es poesía, pero también puede ser magia visual con GSAP</h1> -->
     <h1 class="title">AirPods Pro</h1>
     <canvas id="hero"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>

    <script>

        //simepre al usar un plugin debemos registrarlo
        //si es con el import:
        //import SplitText from "gsap/SplitText"
        //usando cdn:
        gsap.registerPlugin(SplitText);
        gsap.registerPlugin(ScrollTrigger);

        gsap.to('.title', {
            scale: 1.5,
            autoAlpha: 0,
            scrollTrigger: {
                scrub: 2, //vincula el progreso de la animacion con el scroll total de la pagina
                start: "center center", //tambien se puede poner numeros por px
                end: 3500,
                //markers: true, //guia visual para ver donde comienza y termina, esto no se lleva a produccion xdxd
            }
        });

        //se crea un canvas 2d
        const canvas = document.getElementById("hero"); //selecciona el canvas
        const ctx = canvas.getContext("2d"); //el contexto es 2d

        //resolucion del canvas
        canvas.width = 1068;
        canvas.height = 600;

        const TOTAL_FRAMES = 65; //sabemos la cantidad de frames o fotos de la animacion

        //funcion para crear las url
        const createURL = (frame) => {
            //el id de la imagen, pad start dice seran 4 cifras totales, las que no sean indicadas se rellenaran con "0" al inicio de la cadena
            const id = frame.toString().padStart(4, "0");

            return `https://www.apple.com/105/media/us/airpods-pro/2022/d2deeb8e-83eb-48ea-9721-f567cf0fffa8/anim/hero/medium/${id}.png`;
        }

        //array de las imagenes, la declara y le pone el src que le corresponde usando la funcion crear 
        //las crea dinamicamente, una por cada frame que va de 0 a TOTAL_FRAMES 
        const images = Array.from({ length: TOTAL_FRAMES }, (_, i) => {
            const img = new Image();
            img.src = createURL(i);
            return img;
        });
        console.log(images[0]);

        //objeto airpod con la propiedad frame iniciando de 0
        const airpods = {
            frame: 0,
        }
        console.log(airpods);

        //animacion del objeto airpod
        gsap.to(airpods, {
            frame: TOTAL_FRAMES - 1, //indica el numero de frame en el que va
            ease: "none",
            snap: "frame", //frame a frame, no saltos, hace que avancen los frames
            scrollTrigger: {
                scrub: .5,
            },
            //debemos indicar que debe actualizar el frame, bueno si se actualiza, pero no se vuelve a renderizar
            //vuelve a renderizar:
            onUpdate: render,

        });

        //renderizar
        images[0].onload = () => render();

        //function render
        function render(){
            ctx.clearRect(0, 0, canvas.width, canvas.height); //limpiamos el canvas
            ctx.drawImage(images[airpods.frame], 0, 0); //dibuja el array de imagenes[numero de frame] en la posicion 0 0
        }

        //crear una estancia de splitText del elemento h1 
        const splitText = new SplitText(".text", {
            //le pasamos las opciones para separar el texto
            type: "words, chars, lines",
        });

        //animar las palabras
        gsap.from(splitText.chars, {
            duration: 1,
            y: 25, //estado inicial, pos y10 al final pos y0
            //cada palabra es un unico elemento
            stagger: .1, //segundos entre animacion de cada elemento
            //podemos usar opacity o autoAlpha, este ultimo tambien modifica la visibilidad del elemento
            autoAlpha: 0,
            filter: "blur(10px)", //estado inicial, inicia con 10 de blur y al final sin
        })

        //aminacion -> tween

        //to -> desde el estado actual hacia donde tiene que ir
        //from -> desde donde tiene que iniciar la animacion para llegar al estado inicial que tiene
        //fromTo -> combinacion de ambos, se define desde donde inicia y termina. se deben pasar dos objetos
        //set -> establece las propiedades de inmediato sin aplicar animacion
        
        //por defecto esto devuleve un document.querySelectorAll -> selecciona todos los elementos que cumplen con el selector
        // gsap.to('.box', {
        //     x: 100,
        //     duration: 2,
        // });

        // gsap.to('.box:nth-child(2)', {
        //     x: 200,
        //     y: 10, 
        //     duration: 2 
        // });

        //ANIMACION TIPO ESCALERA MANUAL

        //seleccionamos las cajas del dom
        // const boxes = document.querySelectorAll('.box');

        // //iteramos cada caja 
        // boxes.forEach( (box, i) => {
        //     //a cada iteracion se le va agregando la animacion
        //     gsap.to(box, { //en vez de pasar texto, pasamos el elemento box 
        //         x: () => window.innerWidth / 2, //px por defecto, se pueden enviar otras medidas entre comillas "100vh" y HASTA FUNCIONES !!
        //         duration: 1,
        //         delay: i * .5, 
        //     })
        // });

        gsap.to('.boxx', { //todos los que tengan la clase box
            x: 200, //px por defecto, se pueden enviar otras medidas entre comillas "100vh" y HASTA FUNCIONES !!
            duration: 1,
            rotate: 360, //grados c
            scale: .5, //transformacion del tamaño
            //repeat: -1, //-1 es inifinito, otro num es la cant. de repeticiones
            //yoyo: true, //hace que regrese

            //hasta que termine TODO el escalonado se activa la animacion YOYO
            //stagger: .2, //velocidad del escalonado

            //PERO 
            //no necesariamente tiene que esperar a que termine todo el escalonado,
            //se puede animar cada caja
            stagger: {
                each: .2, //velocidad del escalonado
                repeat: -1, //inifinito
                yoyo: true,
            }

        })

        gsap.to('.grid img', {
            duration: 2,
            scale: .9,
            opacity: 0,
            stagger: {
                each: .5,
                repeat: -1,
                yoyo: true,
                grid: 'auto', //actua sabiendo que estan en una malla
                from: 'center', //desde donde inicia la animacion: start, center, edges, end, random
            }
        })

        //SUAVIZADOS -> EASING
        //https://gsap.com/docs/v3/Eases/
        //forma en que una animación acelera o desacelera
        //es lo que le da vida al movimiento

        //separar los elementos con la misma clase
        // gsap.to('.box.purple',{
        //     x: 200,
        //     duration: 2,
        //     rotate: 360,
        //     scale: .75,
        //     repeat: -1, 
        //     yoyo: true,
        //     //ease -> cambia la sensacion del movimiento
        //     // ease: expo, bounce, back, steps, elastic
        //     // in -> inicio, entrada. out -> al terminar, salida
        //     ease: 'expoScale' 
        // });

        
        //aunque tengan la misma animacion, el suavizado los hace ver completamente diferentes
        // gsap.to('.box.blue',{
        //     x: 200,
        //     duration: 2,
        //     rotate: 360,
        //     scale: .75,
        //     repeat: -1, 
        //     yoyo: true,
            
        // });

        //LINEA DEL TIEMPO PARA CONTROLAR LAS ANIMACIONES

        //SIN TIMELINE -> usando delay manual en cada caja
        // gsap.to('.box.purple',{
        //     duration: 2,
        //     x: 200,
        // });

        // gsap.to('.box.blue',{
        //     duration: 1,
        //     y: -80,
        //     delay: 2,
        // });
        
        // gsap.to('.box.green',{
        //     x: 100,
        //     y: -160,
        //     delay: 3,
        // });

        //CON TIMELINE
        const tl = gsap.timeline({
            defaults: {
                duration: 2,
            },
            //se pueden controlar eventos con callbacks
            onComplete: () => {
                window.log.innerHTML += "[event] complete <br>";
            },
            onStart: () => {
                window.log.innerHTML += "[event] ha comenzado <br>";
            },
            onRepeat: () => {
                window.log.innerHTML += "[event] me estoy repitiendo <br>";
            }
        });

        //sincronizacion y ajuste del tiempo de animacion
        //parametros de posicion en la linea del tiempo
        tl
            .to('.box.purple',{
                x: 200,
            })
            .to('.box.blue',{
                y: -80,
                //duration: 1, //el valor por defecto se puede sobreescribir
            }, 2) //parametro de posicion, se sincroniza la animacion en la linea del tiempo
            .to('.box.green',{
                x: 100,
                y: -160,
            }, 3) //parametro de posicion, espera un tiempo despues de la animacion


            //METODOS DE CONTROL CON CALLBACKS
            window.play.onclick = () => {
                tl.play()
                window.log.innerHTML += "play <br>"
            }

            window.pause.onclick = () => {
                tl.pause();
                window.log.innerHTML += "pause <br>"
            }

            window.resume.onclick = () => {
                tl.resume();
                window.log.innerHTML += "resume <br>"
            }

            window.reverse.onclick = () => {
                tl.reverse();
                window.log.innerHTML += "reverse <br>"
            }

            window.restart.onclick = () => {
                tl.restart();
                window.log.innerHTML += "restart <br>"
            }

            window.turbo.onclick = () => {
                tl.timeScale(10); //escala en la que aumenta el movimiento
                window.log.innerHTML += "Y con esta mano me <br>"
            }
    </script>
</body>
</html>